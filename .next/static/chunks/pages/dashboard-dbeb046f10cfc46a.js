(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{2587:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(7876),o=r(4232),s=r(7274),n=r(3679),d=r(6856);r(1616);let i=e=>{let{icon:t,label:r,value:o}=e;return(0,a.jsxs)("div",{style:{backgroundColor:"#030712",border:"1px solid #1A0938",borderRadius:"0.75rem",padding:"1.5rem",flex:"1 1 340px",minWidth:260,width:"100%",display:"flex",alignItems:"flex-start",gap:"1rem",boxSizing:"border-box",height:"100%"},children:[(0,a.jsx)("div",{style:{color:"#8b5cf6",marginTop:2},children:t}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",height:"100%"},children:[(0,a.jsx)("div",{style:{color:"#d1d5db",fontSize:"0.875rem",fontWeight:500,marginBottom:"0.25rem"},children:r}),(0,a.jsx)("div",{style:{color:"white",fontSize:"1.875rem",fontWeight:"bold"},children:o})]})]})},l=()=>(0,a.jsxs)("div",{style:{backgroundColor:"#030712",border:"1px solid #1A0938",borderRadius:"0.75rem",padding:"1.5rem",flex:"1 1 340px",minWidth:260,width:"100%",display:"flex",alignItems:"center",gap:"1rem",animation:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite",boxSizing:"border-box"},children:[(0,a.jsx)("div",{style:{width:"40px",height:"40px",backgroundColor:"#1F2937",borderRadius:"50%"}}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{height:"20px",backgroundColor:"#1F2937",borderRadius:"0.25rem",width:"75%",marginBottom:"0.5rem"}}),(0,a.jsx)("div",{style:{height:"30px",backgroundColor:"#1F2937",borderRadius:"0.25rem",width:"50%"}})]})]}),c=e=>{let{startDate:t,endDate:r,onChange:o}=e;return(0,a.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",backgroundColor:"#030712",borderRadius:"1rem",padding:"0.5rem 1.25rem",color:"white",fontWeight:700,fontSize:"1rem",gap:"0.75rem",boxShadow:"0 2px 8px rgba(0,0,0,0.10)",border:"1.5px solid #1A0938",marginBottom:"1.5rem",width:"fit-content",maxWidth:"100%",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:[(0,a.jsx)(n.LyP,{style:{fontSize:20,color:"#a78bfa",opacity:1,marginRight:4}}),(0,a.jsx)(d.Ay,{selectsRange:!0,startDate:t,endDate:r,onChange:o,dateFormat:"dd 'de' MMM 'de' yyyy",locale:"pt-BR",customInput:(0,a.jsx)(p,{}),calendarClassName:"date-range-calendar"})]})},p=o.forwardRef((e,t)=>{let{value:r,onClick:o}=e;return(0,a.jsx)("button",{onClick:o,ref:t,style:{background:"none",border:"none",color:"white",fontWeight:700,fontSize:"1rem",cursor:"pointer",padding:0,outline:"none"},children:r||"Selecione o per\xedodo"})});function u(e){let{salesData:t,showValues:r=!0,children:s}=e,[d,p]=(0,o.useState)([new Date(new Date().setDate(new Date().getDate()-16)),new Date]),[u,h]=d;if(!t)return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:"1.5rem"},children:[(0,a.jsx)(c,{startDate:u,endDate:h,onChange:e=>{Array.isArray(e)&&e[0]&&e[1]&&p(e)}}),s]}),(0,a.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"1.5rem",width:"100%",justifyContent:"flex-start",marginBottom:"2rem",alignItems:"stretch"},children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(l,{},t))})]});let m=[{icon:(0,a.jsx)(n.lcY,{size:26}),label:"Faturamento",value:r?"R$ ".concat(t.totalRevenue.toLocaleString("pt-BR",{minimumFractionDigits:2})):"••••"},{icon:(0,a.jsx)(n.AsH,{size:26}),label:"Checkouts Iniciados (IC)",value:r?t.totalSales:"••••"},{icon:(0,a.jsx)(n.w8j,{size:26}),label:"Total de Vendas Aprovadas",value:r?t.approvedSales:"••••"},{icon:(0,a.jsx)(n.wTh,{size:26}),label:"Total de Vendas Pendentes",value:r?t.pendingSales:"••••"}];return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:"1.5rem"},children:[(0,a.jsx)(c,{startDate:u,endDate:h,onChange:e=>{Array.isArray(e)&&e[0]&&e[1]&&p(e)}}),s]}),(0,a.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"1.5rem",width:"100%",justifyContent:"flex-start",marginBottom:"2rem",alignItems:"stretch"},children:m.map((e,t)=>(0,a.jsx)(i,{icon:e.icon,label:e.label,value:e.value},t))})]})}var h=r(6184),m=r(1134),g=r(1047),x=r(9099);g.t1.register(g.PP,g.kc,g.E8,g.FN,g.No,g.hE,g.m_,g.s$);let f=()=>{let{user:e,loading:t}=(0,h.A)(),r=(0,x.useRouter)(),[d,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(null),[p,g]=(0,o.useState)([]),[f,b]=(0,o.useState)([]),[y,v]=(0,o.useState)("7d"),[w,j]=(0,o.useState)(!0);if((0,o.useEffect)(()=>{t||e||r.replace("/login")},[e,t,r]),(0,o.useEffect)(()=>{if(e){let t=async()=>{try{let{data:t,error:r}=await s.N.from("checkout_logs").select("status, created_at").eq("user_id",e.id);if(r)throw r;let a=new Date,o=new Date;if("today"===y){o.setHours(0,0,0,0);let e={};for(let t=0;t<24;t++)e[t]={aprovado:0,pendente:0};null==t||t.forEach(t=>{let r=new Date(t.created_at);if(r>=o&&r<=a){let a=r.getHours();"aprovado"===t.status&&e[a].aprovado++,"pendente"===t.status&&e[a].pendente++}});let r=Array.from({length:24},(t,r)=>({hour:r,...e[r]}));b(r)}else{"7d"===y?o.setDate(a.getDate()-6):"14d"===y?o.setDate(a.getDate()-13):"30d"===y&&o.setDate(a.getDate()-29),o.setHours(0,0,0,0);let e={};null==t||t.forEach(t=>{let r=new Date(t.created_at);if(r>=o&&r<=a){let a=r.toLocaleDateString("pt-BR");e[a]||(e[a]={aprovado:0,pendente:0}),"aprovado"===t.status&&e[a].aprovado++,"pendente"===t.status&&e[a].pendente++}});let r=[];for(let e=new Date(o);e<=a;e.setDate(e.getDate()+1))r.push(new Date(e));let s=r.map(t=>{var r,a;let o=t.toLocaleDateString("pt-BR");return{date:o,aprovado:(null==(r=e[o])?void 0:r.aprovado)||0,pendente:(null==(a=e[o])?void 0:a.pendente)||0}});g(s)}}catch(e){g([]),b([])}};(async()=>{try{var t,r,a,o;let{data:n,error:d}=await s.N.rpc("calculate_user_sales_summary",{p_user_id:e.id});if(d)throw d;let l=(null==n?void 0:n[0])||{};i({totalRevenue:Number(null!=(t=l.total_revenue)?t:0),approvedSales:Number(null!=(r=l.approved_sales)?r:0),pendingSales:Number(null!=(a=l.pending_sales)?a:0),totalSales:Number(null!=(o=l.total_sales)?o:0)})}catch(e){console.error("Erro ao buscar dados de vendas:",e),c("Falha ao carregar os dados de vendas.")}})(),t()}},[e,y]),t||!e)return(0,a.jsx)("div",{children:"Carregando..."});if(l)return(0,a.jsx)("p",{style:{color:"#EF4444"},children:l});let A="today"===y,C={labels:A?f.map(e=>"".concat(String(e.hour).padStart(2,"0"),":00")):p.map(e=>{let t=e.date.split("/");return"".concat(t[0]," de ").concat(new Date(t[2],t[1]-1,t[0]).toLocaleString("pt-BR",{month:"short"}))}),datasets:[{label:"Vendas Aprovadas",data:A?f.map(e=>e.aprovado):p.map(e=>e.aprovado),borderColor:"#7910CE",backgroundColor:"rgba(121, 16, 206, 0.15)",borderWidth:4,tension:.5,fill:!0,pointRadius:6,pointBackgroundColor:"#fff",pointBorderColor:"#7910CE",pointBorderWidth:3,pointHoverRadius:9,shadowOffsetX:0,shadowOffsetY:4,shadowBlur:10,shadowColor:"rgba(121, 16, 206, 0.25)"},{label:"Vendas Pendentes",data:A?f.map(e=>e.pendente):p.map(e=>e.pendente),borderColor:"#f59e0b",backgroundColor:"rgba(245, 158, 11, 0.12)",borderWidth:4,tension:.5,fill:!0,pointRadius:6,pointBackgroundColor:"#fff",pointBorderColor:"#f59e0b",pointBorderWidth:3,pointHoverRadius:9,shadowOffsetX:0,shadowOffsetY:4,shadowBlur:10,shadowColor:"rgba(245, 158, 11, 0.18)"}]};return(0,a.jsx)("div",{className:"dashboard-main",style:{width:"100%",boxSizing:"border-box",overflowX:"auto",paddingTop:"2rem",minHeight:"100vh",background:"#030712"},children:(0,a.jsxs)("div",{style:{maxWidth:1400,margin:"0 auto",padding:"0 2rem"},children:[(0,a.jsx)(u,{salesData:d,showValues:w,children:(0,a.jsxs)("button",{onClick:()=>j(e=>!e),style:{display:"inline-flex",alignItems:"center",gap:8,background:"#030712",border:"1.5px solid #1A0938",color:"#fff",fontWeight:700,fontSize:16,borderRadius:12,padding:"0.7rem 1.6rem",cursor:"pointer",boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",transition:"all 0.18s"},children:[(0,a.jsx)(n.Ny1,{style:{color:"#a78bfa",fontSize:18}}),w?"Ocultar valores":"Mostrar valores"]})}),(0,a.jsxs)("div",{style:{marginTop:"2rem",backgroundColor:"#030712",border:"1px solid #1A0938",borderRadius:"0.75rem",padding:"1.5rem"},children:[(0,a.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{style:{fontSize:"1.25rem",fontWeight:"bold",color:"white"},children:"Vis\xe3o Geral de Vendas"}),(0,a.jsx)("p",{style:{color:"#A1A1AA",fontSize:"0.875rem"},children:"Acompanhe o desempenho das suas vendas ao longo do tempo"})]}),(0,a.jsx)("div",{style:{display:"flex",gap:"0.25rem",border:"1px solid #27272A",borderRadius:"0.5rem",padding:"0.25rem"},children:["today","7d","14d","30d"].map(e=>(0,a.jsx)("button",{onClick:()=>v(e),style:{padding:"0.25rem 0.75rem",borderRadius:"0.375rem",border:"none",background:y===e?"#27272A":"transparent",color:y===e?"white":"#A1A1AA",cursor:"pointer"},children:"today"===e?"Hoje":"".concat(e.replace("d","")," dias")},e))})]}),(0,a.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",marginBottom:"1rem",gap:"1rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,a.jsx)("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:"#7910CE"}}),(0,a.jsx)("span",{style:{color:"#A1A1AA",fontSize:"0.875rem"},children:"Vendas Aprovadas"})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,a.jsx)("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:"#f59e0b"}}),(0,a.jsx)("span",{style:{color:"#A1A1AA",fontSize:"0.875rem"},children:"Vendas Pendentes"})]})]}),(0,a.jsx)("div",{style:{width:"100%",height:"350px"},children:(0,a.jsx)(m.N1,{data:C,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},elements:{line:{capBezierPoints:!0},point:{pointStyle:"circle",hoverBorderWidth:4}},scales:{x:{grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"#A1A1AA"}},y:{grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"#A1A1AA"}}}}})})]})]})})}},7580:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return r(2587)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[938,697,701,121,361,636,593,792],()=>t(7580)),_N_E=e.O()}]);